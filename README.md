# team2020

12.07
Добавить в стандарном виде CRUD-модули для:
  ok Материалы на складе
  ok Материалы в резерве
  ok Площадки-партнеры
  ok Продавцы
  ok Агенты

Добавить ссылки на все эти элементы на дашборд


Параметры новой заявки (сделки):
 - Указание материала (возможно (или обязательно), со ссылкой на этот материал в системе)
 - Данные продавца (если материал не из системы) - Имя (компания), место, телефон, прочие данные в комментарии
 - Данные покупателя - Имя (компания), место, телефон, прочие данные в комментарии
 - Способ транспортировки - готовые вариаты или свой вариант (+ комментарий. Можно несколько добавлять)
 - Кто берет на себя обеспечение транспортировки (+ комментарий)
 - Способ оплаты - нал, безнал, отсрочка (+ комментарий)
 - Цена (Если материал есть в системе, то можно вывести цену, за которую он был куплен, чтобы наглядно показать выгоду/целесообразность)
 - Общий комментарий

Сделка может быть одобрена
 - Тогда она принимает соответствующий статус "Сделка одобрена, деньги (будут) выделены"
 - Можно скачать документы, или есть инструкция о том как получить деньги / провести оплату

Если сделка НЕ одобрена.

  Если материала уже по каким-то причинам нет (кто-то другой продал)
   - сделка просто закрывается с соответствующим уведомлением

  Если материал есть, но параметры сделки не устраивают Центральное управление
  - Указывается причина, чтобы Агент ее исправил
    например это могут быть
    - Некоррекно, или неполно заполнены данные
    - Не устраивает цена, или прочие условия/нюансы

  Этот круг запросов может повторяться неогрониченное кол-во раз, и привратиться в консультации и уточнения
  - ? Агент может прокомментировать отказ - попытаться его оспорить, или попросить разъяснения

  Визуально под заявкой отображается история изменений и переписки. По сути эта заявка - это прологнированный тикет (диалог) с формализованными функциями




Чат/тикет-система
 - Разные пользователи могут получать уведомления разного уровня
   - Аналитик, админ, Терпрод получает уведомление от агента и может на него ответить
   - Агент получает ответ на свой запрос от любого, кто может ответить
 - Статус уведомления - "прочитан мной", "прочитан кем-то", "не прочитан"
 - ? список прочитавших уведомление
 - Для того, кто отправил уведомление - отображать прочитал ли получатель
 - ? -//- но не всегда - например Админ/т.п. видят - прочитал ли Агент. А Агенту может и не обязательно видеть - прочитал ли Админ/т.п., важно просто ответ получить
 - Уведомления могут быть помечены как прочитанное или непрочитанное вручную
 - Уведомления могут дублироваться на почту/в телеграм
 - ? Из телеграма можно что-то ответить - как-то отреагировать на сообщение, например подтвердить цену, или наоборот отклонить. Ну или по крайней мере - иметь прямую ссылку для входа в панель управления для ускорения ответа


notification Module

 - связь с автором (юзером)
 - связь с элементом-модулем (матреиал/сделка/...)
 - данные-атрибуты события
 - ? шаблонные действия
 - статус о прочтении - "прочитан мной", "прочитан кем-то", "не прочитан" (? список прочитавших уведомление)
 - статус о прочтении хранится в отдельной таблице notification_views
 - Deal Log = Уведомления, убрать как рудимент

Проблемы notification системы:
 - В качестве old-new значения может быть массив, а не строка. И, ито еще страшнее - пустой, вложенный массив [{ }]
 + Громоздко выглядт запись нового уведомления - Это поправили, вывели в Трейт
 + Приходится отдельно записывать уведомление для замены статуса, т.е. + к громоздскости (Вероятно, можно вынести в отдельный метод контроллера notificationController, и обращаться к нему)
 - не понятно как создавать уведомления динамически, например - При нажатии на "Отменить", чтобы показывалось поле ввода, и этот текст добавлялся к смене статуса об отказе в сделке
 - Насколько гибкая получается система с точки зрения дальнешего обновления на Vue SPA
 - Хотелось бы видеть Уведомления как часть чат/тикет-системы
 - Странно сохраняются изменения в Изображениях
 - Выводить только актуальные для пользователя уведомления

Как сделать уведомление именно для конкретного пользователя.
И иметь возможность настраивать какие получать, а какие нет. Чтобы получать только значимые.
Можно иметь поле, в котором указаны ID пользователей, для которых показывать уведомление. Этот список пользователей формируется, когда создается уведомление.
Особенности - Новый пользователь-админ/аналитик увидит только новые уведомления.
Может быть отделить уведомления от лога изменений все таки?..
А уведомления - это скорее как чат.
Окей, допустим не разделяем. Дополняем запись списком юзеров, для которых это уведомление.
Таблица выглядит так:
user_id | notification_id | viewed (bool) | created_at | viewed_at




Чего не хватает (без Vue).

Добавить сообщение при Отказе в сделке (Тут скорее требуется архитектурное решение)
Вывести кол-во уведомлений (решается через axios)
Чат (Можно и без vue реализовать - с перезагрузкой страницы)
